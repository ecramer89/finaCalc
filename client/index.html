<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <style>
    </style>
    <title>TaxApple</title>

</head>
<body>
    <h1>Calculator</h1>
        <div>
            <form onsubmit="calculate()">
                <div class="form-group" id="calculatorForm">

                    <label for="currentTaxRate" color="red">Current Tax Rate</label>
                    <input type="text" class="form-control" id="currentTaxRate">

                    <label for="amountInvested">Amount Invested</label>
                    <input type="text" class="form-control" id="amountInvested">

                    <label for="retirementTaxRate">Tax Rate in Retirement</label>
                    <input type="text" class="form-control" id="retirementTaxRate">

                    <label for="investmentGrowthRate">Investment Growth Rate</label>
                    <input type="text" class="form-control" id="investmentGrowthRate">

                    <label for="inflationRate">Inflation Rate</label>
                    <input type="text" class="form-control" id="inflationRate">

                    <label for="yearsInvested">Years Invested</label>
                    <input type="text" class="form-control" id="yearsInvested">

                    <button type="submit" class="btn btn-default">Submit</button>
                </div>
            </form>
        </div>
    </body>
<script>

    const calculateURL = "http://localhost:3000/calculate" //note: be sure that you don't change the server code so that it possible pings a different port than 3000

    const formFields = [
      "currentTaxRate",
      "amountInvested",
      "retirementTaxRate",
      "investmentGrowthRate",
      "inflationRate",
      "yearsInvested"
    ]
    //createFormInputFields()

    /*function createFormInputFields(){
      var formGroup = document.getElementById("calculatorForm")
      formFields.map(function(formField){
            const field = formField.field
            const display = formField.display
            var label = document.createElement("label")
            label.className+="form-control"
            label.setAttribute("for", field)
            label.value = display;
            var input = document.createElement("input")
            input.className+="form-control"
            input.id=field
            input.setAttribute("type", "text")
            formGroup.appendChild(label);
            formGroup.appendChild(input)
      })
    }*/


    var formInput = null //lazily initialize on first call to calculate.
    //elements aren't mounted to DOM when the script initially executes.


    function cacheFormElements(){
      formInput = formFields.reduce(function(acc, field){
        acc[field] = document.getElementById(field)
        return acc
      }, {})
    }

    //todo: want to validate each field first; send immediate feedback to client so they can correct the mistake.
    //however, should build analogous validations into the server
    function calculate(){
      if(!formInput) cacheFormElements();
      var params  = Object.keys(formInput).reduce(function(acc, fieldName){
        acc[fieldName] = formInput[fieldName].value
        return acc
      }, {});

      alert(JSON.stringify(params))

      var request = new XMLHttpRequest()

      request.open("POST", calculateURL, true)
      request.setRequestHeader("Accept", "application/json")
      request.setRequestHeader("Content-Type", "application/json")

      request.onreadystatechange = function () {
        if(request.readyState === XMLHttpRequest.DONE && request.status === 200) {
          alert("done: "+request.responseText); //todo need to populate another element with the result of the request
        }
      }


      request.send(JSON.stringify(params))
      event.preventDefault()

    }


</script>
</html>